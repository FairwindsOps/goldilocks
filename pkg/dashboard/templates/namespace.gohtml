{{define "namespace"}}
{{ $foundFirstDeployment := false }}

<article data-filter="{{ .nsSummary.Namespace }}">
  <details class="detailInfo --namespace verticalRhythm" open>
    <summary class="--hideMarker">
      <h2>
        <span aria-label="Deployment:" class="badge detailBadge --namespace"
          >Namespace</span
        >
        {{ .nsSummary.Namespace }}
        <i aria-hidden="true" class="fas fa-fw fa-angle-down --showWhenClosed"></i
        ><i aria-hidden="true" class="fas fa-fw fa-angle-up --showWhenOpen"></i>
      </h2>
      <p>
      {{ if .CurrentCluster }}
        <a
          class="detailLink --namespace"
          href="/dashboard/{{ .nsSummary.Namespace }}?cluster={{ .CurrentCluster }}"
        >View only this namespace</a>
      {{ else }}
        <a
          class="detailLink --namespace"
          href="/dashboard/{{ .nsSummary.Namespace }}"
        >View only this namespace</a>
      {{ end }}
      </p>
    </summary>

    {{ if lt (len .nsSummary.Deployments) 1 }}
    <section class="detailInfo --empty">
      <p>No deployments found in this namespace.</p>
    </section>

    {{ else }}
      {{ range $deployment := .nsSummary.Deployments }}
    <details class="detailInfo --deployment verticalRhythm"
        {{ if not $foundFirstDeployment }}
          {{ $foundFirstDeployment = true }} open
        {{ end }}>
      <summary class="--hideMarker">
        <h3>
          <span aria-label="Deployment:" class="badge detailBadge --deployment"
            >Deployment</span
          >
          {{ $deployment.DeploymentName }}
          <i aria-hidden="true" class="fas fa-fw fa-angle-down --showWhenClosed"></i
          ><i aria-hidden="true" class="fas fa-fw fa-angle-up --showWhenOpen"></i>
        </h3>
      </summary>

      {{ range $cName, $cSummary := $deployment.Containers }}
      <details class="detailInfo --container verticalRhythm" open>
        <summary class="--hideMarker">
          <h4>
            <span aria-label="Container:" class="badge detailBadge --container"
              >Container</span
            >
            {{ $cName }}
            <i aria-hidden="true" class="fas fa-fw fa-angle-down --showWhenClosed"></i
            ><i aria-hidden="true" class="fas fa-fw fa-angle-up --showWhenOpen"></i>
          </h4>
        </summary>

        <div class="layoutLineup">
          {{ template "container" $cSummary }}
        </div>
      </details>
      {{ end }}
    </details>
      {{ end }}
    {{ end }}

  </details>
</article>
{{end}}
